<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Test Error Fixes</title>
  <style>
    body {
      font-family: monospace;
      background: #0a0e13;
      color: #e7eefc;
      padding: 20px;
    }
    .test-result {
      background: #0f1520;
      border: 1px solid #1f2b3e;
      border-radius: 8px;
      padding: 16px;
      margin: 8px 0;
    }
    .pass { border-color: #34d399; }
    .fail { border-color: #f87171; }
    .error { background: #450a0a; }
  </style>
</head>
<body>
  <h1>üß™ Testing Error Fixes</h1>
  <div id="test-results"></div>

  <script type="module">
    import { ComprehensiveSynergyEngine } from './js/core/comprehensive-synergy-engine.js';

    const resultsContainer = document.getElementById('test-results');
    let testsPassed = 0;
    let testsFailed = 0;

    function addTestResult(testName, passed, message) {
      const div = document.createElement('div');
      div.className = `test-result ${passed ? 'pass' : 'fail'}`;
      div.innerHTML = `
        <strong>${passed ? '‚úÖ' : '‚ùå'} ${testName}</strong><br>
        ${message}
      `;
      resultsContainer.appendChild(div);

      if (passed) testsPassed++;
      else testsFailed++;
    }

    try {
      const engine = new ComprehensiveSynergyEngine();

      // Test countMatchingMods with different data types
      console.log('Testing countMatchingMods...');

      // Test 1: null buildMods
      let result = engine.countMatchingMods(['fastball'], null);
      addTestResult('countMatchingMods with null buildMods', result === 0, `Expected 0, got ${result}`);

      // Test 2: undefined buildMods
      result = engine.countMatchingMods(['fastball'], undefined);
      addTestResult('countMatchingMods with undefined buildMods', result === 0, `Expected 0, got ${result}`);

      // Test 3: object with mod categories (realistic data)
      const modData = {
        general: [{ name: 'Fastball', key: 'fastball' }],
        combat: [],
        elementalWells: [],
        chargedWithLight: [],
        stats: [],
        artifact: []
      };
      result = engine.countMatchingMods(['fastball'], modData);
      addTestResult('countMatchingMods with categorized mod object', result === 1, `Expected 1, got ${result}`);

      // Test countMatchingExotics with different data types
      console.log('Testing countMatchingExotics...');

      // Test 4: null buildExotics
      result = engine.countMatchingExotics(['gjallarhorn'], null);
      addTestResult('countMatchingExotics with null buildExotics', result === 0, `Expected 0, got ${result}`);

      // Test 5: object with exotic categories (realistic data)
      const exoticData = {
        weapons: [{ name: 'Gjallarhorn', key: 'gjallarhorn' }],
        armor: [{ name: 'Helm of Saint-14', key: 'helm_of_saint_14' }]
      };
      result = engine.countMatchingExotics(['gjallarhorn'], exoticData);
      addTestResult('countMatchingExotics with categorized exotic object', result === 1, `Expected 1, got ${result}`);

      // Test countMatchingAbilities with different data types
      console.log('Testing countMatchingAbilities...');

      // Test 6: null buildAbilities
      result = engine.countMatchingAbilities(['ward_of_dawn'], null);
      addTestResult('countMatchingAbilities with null buildAbilities', result === 0, `Expected 0, got ${result}`);

      // Test 7: object with abilities (realistic data)
      const abilityData = {
        super: { name: 'Ward of Dawn', key: 'ward_of_dawn' },
        aspects: [],
        fragments: []
      };
      result = engine.countMatchingAbilities(['ward_of_dawn'], abilityData);
      addTestResult('countMatchingAbilities with ability object', result === 1, `Expected 1, got ${result}`);

      // Test extractBuildTriggers with different mod data types
      console.log('Testing extractBuildTriggers...');

      // Test 8: object with categorized mods
      const buildData = {
        mods: {
          general: [{ name: 'Fastball', effects: ['grenade_throw_speed'] }],
          combat: [{ name: 'Auto Rifle Loader', effects: ['reload_speed'] }]
        }
      };
      const triggers = engine.extractBuildTriggers(buildData);
      addTestResult('extractBuildTriggers with categorized mods',
        typeof triggers === 'object' && !isNaN(triggers.on_kill),
        `Expected trigger object, got ${JSON.stringify(triggers)}`);

      // Summary
      console.log(`Tests completed: ${testsPassed} passed, ${testsFailed} failed`);

      const summaryDiv = document.createElement('div');
      summaryDiv.className = `test-result ${testsFailed === 0 ? 'pass' : 'fail'}`;
      summaryDiv.innerHTML = `
        <h3>üìä Test Summary</h3>
        <strong>Total: ${testsPassed + testsFailed} tests</strong><br>
        ‚úÖ Passed: ${testsPassed}<br>
        ‚ùå Failed: ${testsFailed}<br>
        ${testsFailed === 0 ? '<strong>üéâ All fixes working correctly!</strong>' : '<strong>‚ö†Ô∏è Some fixes still need work</strong>'}
      `;
      resultsContainer.appendChild(summaryDiv);

    } catch (error) {
      addTestResult('Module Loading', false, `Failed to load modules: ${error.message}`);

      const errorDiv = document.createElement('div');
      errorDiv.className = 'test-result fail error';
      errorDiv.innerHTML = `
        <h3>üö® Module Loading Error</h3>
        <pre>${error.stack}</pre>
      `;
      resultsContainer.appendChild(errorDiv);
    }
  </script>
</body>
</html>