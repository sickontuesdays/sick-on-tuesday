<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>S!ck on Tuesdays — Command Grid (Draggable/Resizable)</title>
<meta name="description" content="Destiny 2 command-center grid with drag and resize, collision handling." />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root{
    /* Destiny-ish palette */
    --bg:#0a0e13; --panel:#0f1520; --panel2:#121a28;
    --ink:#e7eefc; --muted:#94a7c4; --border:#1f2b3e;
    --arc:#7dd3fc; --arc2:#60a5fa; --good:#34d399;
    --radius:14px; --shadow:0 6px 24px rgba(2,10,20,.35);

    /* GRID TUNING */
    --cols: 12;            /* number of columns */
    --colW: 90px;          /* base column width */
    --rowH: 90px;          /* base row height */
    --gap: 14px;           /* space between cells/cards */
  }
  @media (max-width: 1300px){ :root{ --colW:84px; --rowH:86px; } }
  @media (max-width: 1100px){ :root{ --colW:78px; --rowH:80px; } }
  @media (max-width:  900px){ :root{ --colW:70px; --rowH:74px; } }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font:16px/1.55 Rajdhani, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    color:var(--ink);
    background:
      radial-gradient(1100px 600px at 100% -10%, rgba(18,34,56,.55), transparent 60%),
      radial-gradient(900px 500px at -20% 110%, rgba(24,40,62,.55), transparent 60%),
      linear-gradient(180deg, #081018 0%, #060a10 100%);
  }
  body::before{
    content:""; position:fixed; inset:0; pointer-events:none;
    background:
      linear-gradient(transparent 31px, rgba(125,211,252,.05) 32px),
      linear-gradient(90deg, transparent 31px, rgba(125,211,252,.05) 32px);
    background-size:32px 32px;
    mask-image: linear-gradient(180deg, transparent, #000 12%, #000 88%, transparent);
  }

  .wrap{ width:min(2000px, 80vw); margin:20px auto 60px; }

  header{
    display:flex; align-items:baseline; justify-content:space-between; gap:12px; margin-bottom:14px;
  }
  .brand{display:flex; align-items:baseline; gap:12px}
  .brand h1{margin:0; font-size:28px; font-weight:700; letter-spacing:.04em}
  .brand .badge{color:var(--muted); font-size:13px; letter-spacing:.14em; text-transform:uppercase}
  .status{color:var(--muted); font-size:14px}
  .status .dot{display:inline-block; width:9px; height:9px; border-radius:999px; background:var(--good); box-shadow:0 0 12px var(--good); margin-right:8px}

  /* ===== GRID ===== */
  .grid{
    position:relative; /* for dragging overlay math */
    display:grid;
    grid-template-columns: repeat(var(--cols), minmax(var(--colW), 1fr));
    grid-auto-rows: var(--rowH);
    gap: var(--gap);
  }

  /* ===== CARDS ===== */
  .card{
    position:relative;
    background:linear-gradient(180deg, var(--panel) 0%, var(--panel2) 140%);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    overflow:hidden;
    user-select:none;
  }
  .card:focus-within{ outline:2px solid #2a3a52; outline-offset:2px }

  .bar{
    height:38px; display:flex; align-items:center; justify-content:space-between;
    padding:0 10px; border-bottom:1px solid var(--border);
    background:linear-gradient(180deg,#132033,#0e1726);
    cursor:grab;
  }
  .bar:active{ cursor:grabbing; }
  .title{ font-weight:700; letter-spacing:.04em }
  .handle{ font-weight:700; letter-spacing:.2em; color:var(--muted); user-select:none }

  .content{ padding:12px; color:var(--muted); font-size:14px }
  a{color:var(--arc); text-decoration:none}
  a:hover{text-decoration:underline}

  /* Resize handle */
  .resize{
    position:absolute; width:16px; height:16px; right:6px; bottom:6px;
    border:1px solid var(--border); border-radius:3px;
    background:linear-gradient(135deg, #0e1726 0%, #132033 100%);
    cursor:nwse-resize;
  }

  /* While dragging/resizing, show a subtle “ghost” */
  .dragging{ opacity:.85; box-shadow:0 10px 26px rgba(0,0,0,.45); }

  /* Utility */
  .muted{ color:var(--muted) }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Guardian Command</h1>
        <span class="badge">S!ck on Tuesdays</span>
      </div>
      <div class="status"><span class="dot"></span>Drag & Resize enabled</div>
    </header>

    <main class="grid" id="grid">
      <!-- Initial layout = pattern from earlier (12-col mosaic). 
           data-x/y = column/row start (0-based)
           data-w/h = span width/height in grid units -->
      <section class="card" data-id="D" data-x="0" data-y="0" data-w="8" data-h="6">
        <div class="bar"><div class="title">Season Overview</div><div class="handle">⋮⋮</div></div>
        <div class="content">Main “hero” area. Other boxes can grow/shrink as you arrange.</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Tools" data-x="8" data-y="0" data-w="4" data-h="2">
        <div class="bar"><div class="title">Tools</div><div class="handle">⋮⋮</div></div>
        <div class="content">DIM • light.gg • TodayInDestiny • D2 Foundry</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Rotators" data-x="8" data-y="2" data-w="4" data-h="2">
        <div class="bar"><div class="title">Rotators</div><div class="handle">⋮⋮</div></div>
        <div class="content">Raid: Last Wish • Dungeon: Shattered Throne • Crucible: Momentum</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Vendors" data-x="8" data-y="4" data-w="4" data-h="2">
        <div class="bar"><div class="title">Vendors</div><div class="handle">⋮⋮</div></div>
        <div class="content">Xûr & Banshee quick look.</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Build" data-x="0" data-y="6" data-w="4" data-h="3">
        <div class="bar"><div class="title">Build Spotlight</div><div class="handle">⋮⋮</div></div>
        <div class="content">Warlock/Titan/Hunter builds.</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Mods" data-x="4" data-y="6" data-w="4" data-h="3">
        <div class="bar"><div class="title">Modifiers</div><div class="handle">⋮⋮</div></div>
        <div class="content">Surges, threats, champions.</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Clan" data-x="8" data-y="6" data-w="4" data-h="3">
        <div class="bar"><div class="title">Clan Ops</div><div class="handle">⋮⋮</div></div>
        <div class="content">Roster, fireteams, invites.</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Telemetry" data-x="0" data-y="9" data-w="4" data-h="2">
        <div class="bar"><div class="title">Telemetry</div><div class="handle">⋮⋮</div></div>
        <div class="content">Status pings and simple stats (formerly circles).</div>
        <div class="resize" aria-hidden="true"></div>
      </section>

      <section class="card" data-id="Intel" data-x="4" data-y="9" data-w="8" data-h="2">
        <div class="bar"><div class="title">Intel Feed</div><div class="handle">⋮⋮</div></div>
        <div class="content">Announcements & patch highlights.</div>
        <div class="resize" aria-hidden="true"></div>
      </section>
    </main>
  </div>

<script>
/* ------------- DRAG/RESIZE GRID ENGINE (no libraries) -------------
   - Grid is 12 columns (configurable). Each item has x,y,w,h in grid units.
   - Dragging/resizing snaps to grid.
   - On drop/resize we resolve collisions by pushing collided items DOWN
     until there is space (Gridster-style). If no space in that row segment,
     we scan subsequent rows. The grid grows vertically as needed.
-------------------------------------------------------------------- */
(function(){
  const gridEl = document.getElementById('grid');
  const COLS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols')) || 12;

  const GAP = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--gap')) || 14;
  const COLW = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--colW')) || 90;
  const ROWH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--rowH')) || 90;

  // ---- MODEL ----
  const items = [...gridEl.querySelectorAll('.card')].map(el => ({
    el,
    id: el.dataset.id,
    x: +el.dataset.x, y: +el.dataset.y,
    w: +el.dataset.w, h: +el.dataset.h,
    minW: 1, minH: 1, maxW: COLS
  }));

  function applyLayout(){
    // Set CSS Grid position for each item
    items.forEach(it => {
      it.el.style.gridColumn = `${it.x + 1} / span ${it.w}`;
      it.el.style.gridRow    = `${it.y + 1} / span ${it.h}`;
      // sync data-* (handy for debugging)
      it.el.dataset.x = it.x; it.el.dataset.y = it.y;
      it.el.dataset.w = it.w; it.el.dataset.h = it.h;
    });
  }

  function rectsOverlap(a,b){
    return !(a.x + a.w <= b.x || b.x + b.w <= a.x || a.y + a.h <= b.y || b.y + b.h <= a.y);
  }

  function getCollisions(target, ignoreId=null){
    return items.filter(it => it.id !== target.id && it.id !== ignoreId && rectsOverlap(target, it));
  }

  // Push an item down until it no longer collides (scan rows; keep same x,w if possible)
  function pushDown(item, avoidId=null){
    let changed = false;
    let colliders = getCollisions(item, avoidId);
    while (colliders.length){
      for (const c of colliders){
        c.y = item.y + item.h; // place directly below the pushing item
        changed = true;
      }
      // after moving colliders, we must also resolve any chain-collisions
      colliders = getCollisions(item, avoidId);
    }
    return changed;
  }

  // After each mutation, resolve collisions for all (in y-order)
  function resolveAll(avoidId=null){
    // Sort by y then x to push lower items first
    const ordered = items.slice().sort((a,b)=> (a.y - b.y) || (a.x - b.x));
    let changed = false;
    for (const it of ordered){
      if (pushDown(it, avoidId)) changed = true;
    }
    return changed;
  }

  // Optional "compaction": pull items up if there is free space above them
  function compact(){
    const ordered = items.slice().sort((a,b)=> (a.y - b.y) || (a.x - b.x));
    for (const it of ordered){
      let newY = it.y;
      while (newY > 0){
        const test = { ...it, y: newY - 1 };
        if (!getCollisions(test).length){
          it.y = newY - 1;
          newY--;
        } else { break; }
      }
    }
  }

  // Keep within bounds horizontally
  function clampToCols(it){
    if (it.w > COLS) it.w = COLS;
    if (it.x < 0) it.x = 0;
    if (it.x + it.w > COLS) it.x = COLS - it.w;
  }

  // ---- DRAGGING ----
  let dragging = null;
  let startMouse = null;
  let startPos = null;

  gridEl.addEventListener('mousedown', e => {
    const bar = e.target.closest('.bar');
    if (!bar) return;
    const el = bar.closest('.card');
    const it = items.find(i => i.el === el);
    dragging = it;
    startMouse = { x: e.clientX, y: e.clientY };
    startPos   = { x: it.x, y: it.y };
    it.el.classList.add('dragging');
    e.preventDefault();
  });

  window.addEventListener('mousemove', e => {
    if (!dragging) return;
    const dx = e.clientX - startMouse.x;
    const dy = e.clientY - startMouse.y;
    // convert px delta to grid units (snap)
    const gx = Math.round(dx / (COLW + (GAP*(COLS-1)/COLS? 0 : 0)) ); // simple snap
    const gy = Math.round(dy / (ROWH) );
    dragging.x = startPos.x + gx;
    dragging.y = Math.max(0, startPos.y + gy);
    clampToCols(dragging);
    resolveAll(dragging.id);
    applyLayout();
  });

  window.addEventListener('mouseup', () => {
    if (!dragging) return;
    dragging.el.classList.remove('dragging');
    dragging = null;
    compact(); resolveAll(); applyLayout();
  });

  // ---- RESIZING ----
  let resizing = null;
  let startSize = null;

  gridEl.addEventListener('mousedown', e => {
    const h = e.target.closest('.resize');
    if (!h) return;
    const el = h.closest('.card');
    const it = items.find(i => i.el === el);
    resizing = it;
    startMouse = { x: e.clientX, y: e.clientY };
    startSize  = { w: it.w, h: it.h };
    it.el.classList.add('dragging');
    e.preventDefault();
    e.stopPropagation();
  });

  window.addEventListener('mousemove', e => {
    if (!resizing) return;
    const dx = e.clientX - startMouse.x;
    const dy = e.clientY - startMouse.y;
    const dw = Math.round(dx / (COLW) );
    const dh = Math.round(dy / (ROWH) );
    resizing.w = Math.max(resizing.minW, Math.min(resizing.maxW, startSize.w + dw));
    resizing.h = Math.max(resizing.minH, startSize.h + dh);
    clampToCols(resizing);
    resolveAll(resizing.id);
    applyLayout();
  });

  window.addEventListener('mouseup', () => {
    if (!resizing) return;
    resizing.el.classList.remove('dragging');
    resizing = null;
    compact(); resolveAll(); applyLayout();
  });

  // Initial paint
  resolveAll(); applyLayout();

  // Optional: keyboard nudging (arrow keys while focused on a card)
  gridEl.addEventListener('keydown', (e) => {
    const el = e.target.closest('.card'); if (!el) return;
    const it = items.find(i => i.el === el);
    if (!it) return;
    let used = true;
    switch(e.key){
      case 'ArrowLeft': it.x -= 1; break;
      case 'ArrowRight': it.x += 1; break;
      case 'ArrowUp': it.y = Math.max(0, it.y - 1); break;
      case 'ArrowDown': it.y += 1; break;
      default: used = false;
    }
    if (used){
      clampToCols(it); resolveAll(it.id); applyLayout(); e.preventDefault();
    }
  });
})();
</script>
</body>
</html>
